angular.module("havefun",["ionic","havefun.controllers","havefun.services","ngCordova","ngSanitize"]).constant("$ionicLoadingConfig",{template:"加载中 ...",duration:600}).run(["$ionicPlatform","$rootScope",function(t,e){t.ready(function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleLightContent(),ionic.Platform.isFullScreen=!0,"addEventListener"in document&&document.addEventListener("deviceready",function(){},!1)});var a,o,n,r,s=!1;o=function(t,e,a,o,n){$("video").each(function(t,e){e.pause()})},n=r=function(t,e,a,o,n){},a=function(){s||(s=!0,e.$on("$stateChangeStart",o),e.$on("$stateChangeSuccess",n),e.$on("$stateChangeError",r),e.$on("$stateNotFound",r),e.$on("$routeChangeStart",o),e.$on("$routeChangeSuccess",n),e.$on("$routeChangeError",r))},e.$on("$stateChangeSuccess",a)}]).config(["$ionicConfigProvider","$sceDelegateProvider",function(t,e){t.views.maxCache(5),t.tabs.position("bottom"),t.tabs.style("standard"),t.platform.android.navBar.alignTitle("center"),t.views.transition("none"),e.resourceUrlWhitelist(["self",new RegExp("^(http[s]?)://(w{3}.)?w3school.com/.+$")])}]).config(["$stateProvider","$urlRouterProvider",function(t,e){e.otherwise("/tab/videos"),t.state("test",{url:"/test",templateUrl:"test.html"}).state("tab",{url:"/tab","abstract":!0,templateUrl:"templates/tabs.html"}).state("tab.dash",{url:"/videos",views:{"tab-dash":{templateUrl:"templates/tab-dash.html",controller:"dashController"}}}).state("tab.tasks",{url:"/tasks",views:{"tab-tasks":{templateUrl:"templates/tasks.html",controller:"tasksController"}}}).state("tab.task-detail",{url:"/task/:taskId",views:{"tab-tasks":{templateUrl:"templates/task-detail.html",controller:"taskDetailController"}}}).state("tab.account",{url:"/account",views:{"tab-account":{templateUrl:"templates/tab-account.html",controller:"accountController"}}}).state("share",{url:"/share?videoId&taskId&userId",templateUrl:"templates/shareVideo.html",controller:"shareVideoController"})}]),angular.module("havefun.services",[]),angular.module("havefun.filters",[]),angular.module("havefun.directives",[]),angular.module("havefun.controllers",["havefun.services","havefun.directives","havefun.filters"]),angular.module("havefun.modules",[]);
angular.module("havefun.controllers").controller("accountController",["$scope","$ionicModal","queryService","modalService",function(o,c,e,n){window.scope=o,e.account.getAccount(function(c){o.curAccount=c,o.accountVideos=[]}),o.refreshVideos=function(c){e.account.queryVideo(c,function(c,e){Array.prototype.splice.apply(o.accountVideos,[0,o.accountVideos.length].concat(e)),console.log(o.accountVideos),o.curAccountVideoModal.show()})},c.fromTemplateUrl("templates/account-video.html",{animation:"slide-in-up",scope:o,backdropClickToClose:!1}).then(function(c){o.curAccountVideoModal=c}),o.queryVideo=function(c){o.curType=c?"上传":"分享",o.refreshVideos(c)},o.quitQueryVideo=function(){o.curAccountVideoModal.hide()},o.showCurAccountVantage=function(){n.show("templates/accountVantage.html","accountController")}}]);
angular.module("havefun.controllers").controller("dashController",["$sce","$scope","$ionicTabsDelegate","$ionicPopup","$timeout","$q","$ionicScrollDelegate","queryService","shareService","modalService",function(e,t,o,a,s,r,i,n,l,c){function d(e){var o=r.defer();return n.video.getAll(e,function(a,s){var r=s.videoList,i=s.sum;if(i){var n=e.start+s.videoList.length,l=e.start;n>=i?t.hasNextPage=!1:l+=e.count,o.resolve({videoList:r,hasNextPage:t.hasNextPage,start:l})}else o.resolve({videoList:r,hasNextPage:!1,start:0})}),o.promise}function p(){t.hasNextPage=!0,t.loadError=!1,t.start=0,t.count=10}window.scope=t,t.types=[{typeId:"YLK",typeName:"娱乐控"},{typeId:"SMK",typeName:"数码控"},{typeId:"YXK",typeName:"游戏控"},{typeId:"DYK",typeName:"电影控"}],t.hasNextPage=!0,t.videos=[],t.typeId="DYK",t.lastVideoId=1,s(function(){o.$getByHandle("video-type-tabs").select(1)}),t.getTypeVideos=function(e){t.typeId=e.typeId,t.start=0,t.refreshVideos(),$(".scroll-div").scrollTop(0)},p(),t.loadMoreVideos=function(){var e=t.start,o=t.count;t.hasNextPage&&d({type:t.typeId,start:e,count:o}).then(function(e){t.hasNextPage=e.hasNextPage,t.start=e.start,Array.prototype.splice.apply(t.videos,[t.videos.length,t.videos.length].concat(e.videoList))})["finally"](function(){t.$broadcast("scroll.infiniteScrollComplete")})},t.cancelAllVideo=function(){alert(!0)},t.refreshVideos=function(){var e=0,o=t.count;d({type:t.typeId,start:e,count:o}).then(function(e){t.hasNextPage=e.hasNextPage,t.start=e.start,Array.prototype.splice.apply(t.videos,[0,t.videos.length].concat(e.videoList))})["finally"](function(){t.$broadcast("scroll.refreshComplete")})},t.shareVideo=function(e){t.curVideo=e,c.show("templates/share.html","shareController",{video:e}).then(function(e){console.log(e)})}}]);
angular.module("havefun.controllers").controller("shareController",["$scope","$log","$ionicPopup","shareService","queryService","modalService","parameters",function(e,i,n,o,a,t,r){e.allShareItems=[{type:"timeline",name:"朋友圈"},{type:"weixin",name:"微信好友"},{type:"kongjian",name:"QQ空间"},{type:"qq",name:"QQ"},{type:"renren",name:"人人"},{type:"xinlang",name:"新浪"}],e.curVideo=r.video,e.shareVideo=function(i){var r={message:{title:e.curVideo.name,description:e.curVideo.description,thumb:"https://effevo.com/app/index/img/icon.png",media:{type:Wechat.Type.WEBPAGE,webpageUrl:"http://public.dev.effevo.com/#/share?videoId="+e.curVideo.videoId}},scene:Wechat.Scene.TIMELINE};o.weixin.shareToTimeLine(r,function(i){var o=n.alert({title:"分享",template:i?"分享成功!":"取消分享!"});o.then(function(e){t.hide()}),i&&a.account.addUserShare(1,e.curVideo.videoId)})}}]);
angular.module("havefun.controllers").controller("shareVideoController",["$scope","$stateParams","$ionicModal","queryService",function(e,o,r,n){n.video.getById(o.videoId,function(o,r){e.video=r[0]})}]);
angular.module("havefun.controllers").controller("taskDetailController",["$scope","$stateParams","$log","$cordovaFileTransfer","$ionicPopup","queryService","utilService","modalService",function(o,e,t,a,n,i,l,r){window.scope=o,o.taskId=e.taskId,i.task.getByTaskId(o.taskId,function(e,t){t&&(o.task=t,console.log(t))}),o.uploadVideo=function(){l.getVideoMethod(function(e){var t=function(e){var t={taskId:o.taskId,userId:55};e&&i.util.uploadFile(e,"video/mp4",t).then(function(o){o?l.showLoading("上传成功,待管理员审核!",5e3):l.showLoading("上传成功,待管理员审核!",5e3)})["catch"](function(o){n.alert("上传失败!")})};if(e){var a={mediaType:1};l.openCamera(a,function(o,e){t(e)})}else{var a={limit:1};l.captureVideo(a,function(o,e){t(e[0].fullPath)})}})},o.shareVideo=function(e){o.curVideo=e,r.show("templates/share.html","shareController",{video:e}).then(function(o){console.log(o)})}}]);
angular.module("havefun.controllers").controller("tasksController",["$scope","queryService",function(e,l){l.task.getAll("",function(l,o){e.tasks=o})}]);
angular.module("havefun.directives").directive("videoPoster",["$sce",function(e){return{restrict:"EA",link:function(e,i,n){e.$eval(n)}}}]);
angular.module("havefun.directives").directive("infiniteScroll",["$rootScope","$window","$timeout",function(i,n,e){return{link:function(o,l,t){console.log("infiniteScroll"),console.log(n);var r,c,f,a;n=angular.element(n),f=0,null!=t.infiniteScrollDistance&&o.$watch(t.infiniteScrollDistance,function(i){return f=parseInt(i,10)}),a=!0,r=!1,null!=t.infiniteScrollDisabled&&o.$watch(t.infiniteScrollDisabled,function(i){return a=!i,a&&r?(r=!1,c()):void 0}),c=function(){var n,e,c,u;return u=$(window).height()+$(window).scrollTop(),n=$(l).offset().top+$(l).height(),e=n-u,c=e<=$(window).height()*f,c&&a?i.$$phase?o.$eval(t.infiniteScroll):o.$apply(t.infiniteScroll):c?r=!0:void 0};var u=t.infiniteScrollContainer?$(t.infiniteScrollContainer):n;return u.on("scroll",c),o.$on("$destroy",function(){return u.off("scroll",c)}),e(function(){return t.infiniteScrollImmediateCheck?o.$eval(t.infiniteScrollImmediateCheck)?c():void 0:c()},0)}}}]);
angular.module("havefun.filters").filter("trustUrl",["$sce",function(r){return function(t){return r.trustAsResourceUrl(t)}}]).filter("statusFilter",function(){return function(r){switch(r){case 0:return"未审核";case 1:return"己通过";case 2:return"未通过"}}});
angular.module("havefun.services").factory("modalService",["$ionicModal","$rootScope","$q","$injector","$controller",function(o,e,n,r,c){function i(r,i,l){var m=n.defer();return t=e.$new(),u=t.$id,o.fromTemplateUrl(r,{scope:t,animation:"slide-in-up"}).then(function(o){t.modal=o,t.openModal=function(){t.modal.show()},t.closeModal=function(o){m.resolve(o),t.modal.hide()},t.$on("modal.hidden",function(o){if(o.currentScope){var e=o.currentScope.$id;u===e&&(m.resolve(null),a(o.currentScope))}}),console.log(l);var e={$scope:t,parameters:l};d=c(i,e),t.modal.show()},function(o){m.reject(o)}),m.promise}function l(){t.modal.hide()}function a(o){o.$destroy(),o.modal&&o.modal.remove()}return{show:i,hide:l};var t,d,u}]);
angular.module("havefun.services").factory("pushService",["$q","$http","$log","$window",function(i,n,s,u){var t,g={},l=function(i){if(t=window.plugins&&window.plugins.jPushPlugin){window.plugins.jPushPlugin.init(),document.addEventListener("jpush.setTagsWithAlias",i.stac,!1),window.plugins.jPushPlugin.openNotificationInAndroidCallback=i.oniac,window.plugins.jPushPlugin.setDebugMode(!1);var n=function(i){try{}catch(n){}};window.plugins.jPushPlugin.getRegistrationID(n)}},o=function(i){u.plugins.jPushPlugin.isPushStopped(i)},e=function(){u.plugins.jPushPlugin.stopPush()},P=function(){u.plugins.jPushPlugin.resumePush()},h=function(i,n){u.plugins.jPushPlugin.setTagsWithAlias(i,n)},a=function(i){u.plugins.jPushPlugin.setTags(i)},p=function(i){u.plugins.jPushPlugin.setAlias(i)};return g.init=l,g.isPushStopped=o,g.stopPush=e,g.resumePush=P,g.setTagsWithAlias=h,g.setTags=a,g.setAlias=p,g}]);
angular.module("havefun.services").factory("queryService",["$q","$http",function(e,o){function i(e,i){o.get(t+e).success(function(e,o,n,t){i&&i(null,e)}).error(function(e,o,n,t){i&&i(e)})}function n(e){var o=[];for(var i in e)e.hasOwnProperty(i)&&o.push(i+"="+e[i]);return o.join("&")}var t="http://hm.sogouqa.com/api";return{util:{uploadFile:function(o,i,n){var t=e.defer(),r="http://hm.sogouqa.com/api/upload",a=new FileTransfer,l=new FileUploadOptions,s=function(e){cordova.plugin.pDialog.dismiss(),t.resolve(e)},d=function(e){cordova.plugin.pDialog.dismiss(),t.reject(e)};return l.fileKey="file",l.fileName=o.substr(o.lastIndexOf("/")+1),l.mimeType="video/mp4",l.params=n,cordova.plugin.pDialog.init({progressStyle:"HORIZONTAL",title:"上传文件",message:"正在上传中..."}),a.onprogress=function(e){e.lengthComputable&&cordova.plugin.pDialog.setProgress(parseInt(e.loaded/e.total*100))},a.upload(o,r,s,d,l),t.promise}},video:{getAll:function(e,o){i("/video?"+n(e),o)},getById:function(e,o){i("/video?id="+e,o)}},task:{getAll:function(e,o){i("/task?"+n(e),o)},getByTaskId:function(e,o){i("/task/?id="+e,function(e,i){if(console.log(i),e)o(e,null);else{var n={title:i.title,description:i.description,startTime:i.startTime,endTime:i.endTime,moneyAll:i.moneyAll,moneyAwarded:i.moneyAwarded,adoptMoney:i.adoptMoney,sharedMoney:i.sharedMoney,demoVideo:i.demoVideo,childVideo:i.childVideo};o(null,n)}})}},account:{getAccount:function(e){var o={userName:"小w",userFace:"",userValue:"346"};e(o)},addUserShare:function(e,o){i("/share?userId="+e+"&videoId="+o,callback)},queryVideo:function(e,o){e?i("/video?uploadUser=1",o):i("/video?sharedUser=1",o)}}}}]);
angular.module("havefun.services").factory("shareService",["$q","$http","$log",function(n,c,e){return{weixin:{checkInstalled:function(n){Wechat.isInstalled(function(c){n(c)},function(c){e.error(c),n(!1)})},shareTextToTimeline:function(n){this.checkInstalled(function(c){c&&Wechat.share({text:n,scene:Wechat.Scene.SESSION},function(){callback&&callback(!0)},function(n){callback&&callback(!1,n)})})},shareToTimeLine:function(n,c){this.checkInstalled(function(e){e&&Wechat.share(n,function(){c&&c(!0)},function(n){c&&c(!1,n)})})}}}}]);
angular.module("havefun.services").factory("utilService",["$ionicActionSheet","$cordovaCamera","$ionicLoading","$ionicPopup","$cordovaCapture",function(e,o,n,t,i){var c={showLoading:function(e){n.show({template:e,noBackdrop:!0,duration:1e3})},showPopup:function(){var e=t.confirm({title:"退出此次编辑？",cancelText:"取消",okText:"退出"});return e},getVideoMethod:function(o){e.show({buttons:[{text:"拍摄"},{text:"本地选取"}],cancelText:"取消",cancel:function(){},buttonClicked:function(e){return o(e),!0}})},openCamera:function(e,n){var t={destinationType:Camera.DestinationType.NATIVE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,mediaType:e.mediaType||2,cameraDirection:0,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!0};o.getPicture(t).then(function(e){n(null,e)},function(e){n(e)})},captureVideo:function(e,o){i.captureVideo(e).then(function(e){o(null,e)},function(e){o({msg:"error"})})}};return c}]);